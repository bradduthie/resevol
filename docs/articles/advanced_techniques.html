<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced techniques • resevol</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced techniques">
<meta property="og:description" content="resevol">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">resevol</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/resevol.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced_techniques.html">Advanced techniques</a>
    </li>
    <li>
      <a href="../articles/evolutionary_algorithm.html">The evolutionary algorithm</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://bradduthie.github.io/resevol/notebook/" class="external-link">Lab notebook</a>
</li>
<li>
  <a href="https://github.com/bradduthie/resevol" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced techniques</h1>
                        <h4 data-toc-skip class="author">A Bradley
Duthie</h4>
            
            <h4 data-toc-skip class="date">2022-08-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bradduthie/resevol/blob/HEAD/vignettes/advanced_techniques.Rmd" class="external-link"><code>vignettes/advanced_techniques.Rmd</code></a></small>
      <div class="hidden name"><code>advanced_techniques.Rmd</code></div>

    </div>

    
    
<hr>
<div class="section level2">
<h2 id="introduction">
<a name="introduction">Introduction</a><a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here we focus on advanced techniques for simulating pest ecological
and evolutionary dynamics using the resevol R package. In the <a href="resevol.html">main text</a>, we provided a <a href="resevol.html#simulation">simple example</a> of individual-based
simulations to demonstrate how to get started. This document focuses
instead on demonstrating the more advanced options of the package and
showcasing what it can do. The case study will focus on crop and
pesticide rotation on a complex, customised landscape that includes
farmland, grassland, forest, and water. The pest species will be
sexually reproducing and obligately biparental, and its life history
will include an egg and larval stage during which it feeds on crops and
consumes pesticide, and a stage during which it moves, mates, and
reproduces. The pest species will include a total of four evolving
traits that affect the consumption of two crops and two pesticides. The
objective of simulations will be to test how pest population size
changes and traits evolve given different pesticide rotation regimes.
Below, we explain how to model this system in detail, including all of
the necessary code for reproducing the example within the text.</p>
</div>
<div class="section level2">
<h2 id="initialising-pest-genomes">
<a name="mining">Initialising pest genomes</a><a class="anchor" aria-label="anchor" href="#initialising-pest-genomes"></a>
</h2>
<p>First, we need to use the <code>mine_gmatrix</code> function to
initialise pest genomes. In our example, individuals will have four
covarying traits resulting from 12 loci. There will be 4 internal nodes
that map loci values to traits (see the <a href="evolutionary_algorithm.html">Evolutionary Algorithm</a>
explanation for details). The trait covariance structure will be defined
as below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://bradduthie.github.io/resevol/" class="external-link">"resevol"</a></span><span class="op">)</span>;
<span class="va">gmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, 
                       <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="op">-</span><span class="fl">0.6</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.6</span>, <span class="fl">0.4</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gmt</span><span class="op">)</span>;</code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3] [,4]</span>
<span class="co">## [1,]  1.0 -0.5  0.2  0.2</span>
<span class="co">## [2,] -0.5  1.0  0.2  0.2</span>
<span class="co">## [3,]  0.2  0.2  0.4 -0.6</span>
<span class="co">## [4,]  0.2  0.2 -0.6  0.4</span></code></pre>
<p>Rows and columns 1 and 2 will represent traits underlying the
consumption rate of crops 1 and 2, respectively. Hence, the variation in
crop consumption rate is 1 for both crops, while the covariance in
consumption rate is -0.5, meaning that there is a trade-off between pest
ability to consume crop 1 versus crop 2. Rows and columns 3 and 4 will
represent traits underlying the consumption rate of pesticides 1 and 2,
respectively. Hence, the variation in pesticide consumption rate is 0.4
for both pesticides, which is lower than what it is for crops. There is
a trade-off in the consumption rate of pesticide 1 versus pesticide 2,
which is reflected in the covariance of -0.6 in the above matrix.
Finally, there is a positive covariance of 0.2 between all crop and all
pesticide consumption rates. What this means is that pests that consume
crops quickly also tend to consume pesticides quickly, causing a
potential trade-off between the beneficial effects of feeding ability
and the negative effects of pesticides. We can now use the
<code>mine_gmatrix</code> function to find a network mapping loci to
traits that satisfies the above trait covariance structure. The options
used below in <code>mine_gmatrix</code> arguments will lead to a
computationally intense (and therefore time-consuming) search,
particularly due to the large number of networks in the population
(<code>npsize = 12000</code>), high number of individuals used to test
network stress (<code>indivs = 2000</code>), high number of hidden nodes
(<code>layers = 4</code>), strict stress criteria
(<code>term_cri = -8</code>), and high maximum generation number
(<code>max_gen = 5400</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span>;
<span class="va">mg</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mine_gmatrix.html">mine_gmatrix</a></span><span class="op">(</span>gmatrix <span class="op">=</span> <span class="va">gmt</span>, loci <span class="op">=</span> <span class="fl">12</span>, indivs <span class="op">=</span> <span class="fl">2000</span>, npsize <span class="op">=</span> <span class="fl">12000</span>, 
                    max_gen <span class="op">=</span> <span class="fl">5400</span>, sampleK <span class="op">=</span> <span class="fl">1200</span>, chooseK <span class="op">=</span> <span class="fl">6</span>, layers <span class="op">=</span> <span class="fl">4</span>,
                    mu_pr <span class="op">=</span> <span class="fl">0.2</span>, pr_cross <span class="op">=</span> <span class="fl">0.2</span>, mu_sd <span class="op">=</span> <span class="fl">0.004</span>, 
                    term_cri <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span>;</code></pre></div>
<p>To save time, a genome <code>mg</code> produced from the code above
has been saved into the resevol R package as
<code>advanced_techniques_eg.rda</code>, which we can load. Note that
running <code>mine_gmatrix</code> can be a time-consuming process, and
will often require multiple attempts to get the above parameter settings
to produce a desired network. See <span class="citation">Hamblin (<a href="#ref-Hamblin2013" role="doc-biblioref">2013</a>)</span> for useful
advice on parameter value selection for the evolutionary algorithm.
Time-sensitive parameter values specific to the resevol package include
<code>indivs</code> and <code>layers</code>. Increasing values for both
of these parameters can increase run time.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"advanced_eg.rda"</span>, package <span class="op">=</span> <span class="st">"resevol"</span><span class="op">)</span><span class="op">)</span>;</code></pre></div>
<p>The contents of each list element of <code>mg</code> are not
important for our purposes, but an explanation is available in the <a href="../reference/mine_gmatrix.html">package documentation</a>. What is
important is the sixth list element, which holds the estimated
covariance structure found by the evolutionary algorithm.</p>
<pre><code><span class="co">##            [,1]       [,2]       [,3]       [,4]</span>
<span class="co">## [1,]  1.0677123 -0.4510309  0.1225596  0.1277905</span>
<span class="co">## [2,] -0.4510309  1.0449414  0.1251180  0.1217368</span>
<span class="co">## [3,]  0.1225596  0.1251180  0.5014936 -0.3992066</span>
<span class="co">## [4,]  0.1277905  0.1217368 -0.3992066  0.5011398</span></code></pre>
<p>We can compare the above covariance structure with the one that we
specified in <code>gmt</code>. The stress of <code>mg</code> (i.e., mean
squared deviation of <code>mg</code> elements from <code>gmt</code>
elements) is 0.0099034. But this is only based on one population of
<code>indivs = 2000</code> initialised pests. We can use the
<code>stress_test</code> function to see what the distribution of stress
is over 1000 such initialised populations of 2000 individuals (Figure
1).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_stress</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stress_test.html">stress_test</a></span><span class="op">(</span>mine_output <span class="op">=</span> <span class="va">mg</span>, indivs <span class="op">=</span> <span class="fl">2000</span>, reps <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sim_stress</span>, main <span class="op">=</span> <span class="st">""</span>, breaks <span class="op">=</span> <span class="fl">20</span>, xlab <span class="op">=</span> <span class="st">"Initialised stress"</span><span class="op">)</span>;</code></pre></div>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-6-1.png" alt="**Figure 1**. *Distribution of stress for initialised pest trait covariances in the resevol R package. Stress values are computed using genome values produced by the `mine_gmatrix` function for 1000 replicate populations of initialised pest loci values.*" width="576"><p class="caption">
<strong>Figure 1</strong>. <em>Distribution of stress for initialised
pest trait covariances in the resevol R package. Stress values are
computed using genome values produced by the <code>mine_gmatrix</code>
function for 1000 replicate populations of initialised pest loci
values.</em>
</p>
</div>
<p>If we are satisfied with the distribution of stress, then we can
accept <code>mg</code> as the genome for our initialised pests. The
whole contents of <code>mg</code> will then be passed on to the
<code>run_farm_sim</code> function, which initialises pests using the
genome values in <code>mg</code> before running simulations. Before
doing any of this, because we want to run a simulation on a customised
landscape, we will explain how such a landscape can be generated and
inserted into the simulation.</p>
</div>
<div class="section level2">
<h2 id="landscape">
<a name="land">Landscape</a><a class="anchor" aria-label="anchor" href="#landscape"></a>
</h2>
<p>Default settings for running simulations with the
<code>run_farm_sim</code> function create a spatially explicitly
landscape with dimensions specified by arguments <code>xdim</code> and
<code>ydim</code>, and a number of farms specified by
<code>farms</code>. These arguments can be over-ridden with a matrix
that defines landscape cell identities, which is set in the
<code>terrain</code> argument. A very simple custom 12 by 12 landscape
might look something like the below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simple_terrain</span>              <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">12</span>, ncol <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>   <span class="op">&lt;-</span> <span class="fl">2</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">3</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">3</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fl">4</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">7</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">5</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">8</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fl">5</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>   <span class="op">&lt;-</span> <span class="fl">6</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">5</span><span class="op">]</span>      <span class="op">&lt;-</span> <span class="fl">6</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">7</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">7</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>    <span class="op">&lt;-</span> <span class="fl">7</span>;
<span class="va">simple_terrain</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fl">7</span>;
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">simple_terrain</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]</span>
<span class="co">##  [1,]    1    1    1    7    7    3    3    3    3     4     4     4</span>
<span class="co">##  [2,]    1    1    1    7    7    3    3    3    3     4     4     4</span>
<span class="co">##  [3,]    1    1    6    6    7    7    3    3    3     4     4     4</span>
<span class="co">##  [4,]    1    1    6    6    7    7    3    3    3     4     4     4</span>
<span class="co">##  [5,]    1    1    6    6    7    7    3    3    3     4     4     4</span>
<span class="co">##  [6,]    1    1    6    6    7    7    3    3    3     4     4     4</span>
<span class="co">##  [7,]    1    1    6    6    6    7    7    5    5     5     5     5</span>
<span class="co">##  [8,]    2    2    6    6    6    7    7    5    5     5     5     5</span>
<span class="co">##  [9,]    2    2    6    6    6    7    7    5    5     5     5     5</span>
<span class="co">## [10,]    2    2    6    6    7    7    5    5    5     5     5     5</span>
<span class="co">## [11,]    2    2    6    6    7    7    5    5    5     5     5     5</span>
<span class="co">## [12,]    2    2    6    6    7    7    5    5    5     5     5     5</span></code></pre>
<p>What is important is that the matrix elements only include natural
numbers from 1 to the total number of farms (not skipping any numbers).
In the case of the above, numbers 1-7 all appear on the landscape, so
the matrix will work. We can visualise the matrix more clearly by
looking at it as an image (Figure 2).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">simple_terrain</span><span class="op">)</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, useRaster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>;</code></pre></div>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-8-1.png" alt="**Figure 2**. *Image representing a simple landscape for the resevol package created from a 12 by 12 matrix of natural numbers from 1-7.*" width="480"><p class="caption">
<strong>Figure 2</strong>. <em>Image representing a simple landscape for
the resevol package created from a 12 by 12 matrix of natural numbers
from 1-7.</em>
</p>
</div>
<p>In Figure 2, each colour represents a unique farm, and colours
correspond to the numbers within the matrix <code>simple_terrain</code>
(note that the orientation differs between the matrix and the image).
This is a simple example, but matrices can be made large to model highly
complex landscapes. Additionally, not every colour needs to represent a
‘farm’ per se. We can represent other types of terrain such as
grassland, woodland, or water with its own natural number. The trick in
this case is to have each of these other types of terrain grow a crop
and use a pesticide that has no effect on pests (i.e., cannot be
consumed). If terrain types have no effect on pests, then they can
effectively model land that is not used for farming. We can show this
using the matrix <code>land_eg</code>, which is also included in the
resevol package. The dimensions of the landscape modelled in
<code>land_eg</code> are 128 by 128 cells, and the landscape includes 14
farms (1-14), grassland (15), forest (16), and water (17). The code
below produces an image that shows how these terrain types are
distributed over the landscape (Figure 3).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">land_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"landscape_eg.csv"</span>, package <span class="op">=</span> <span class="st">"resevol"</span><span class="op">)</span>;
<span class="va">land_dat</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">land_file</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>;
<span class="va">land_eg</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">land_dat</span><span class="op">)</span><span class="op">)</span>;
<span class="va">farm_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#f4eadc"</span>, <span class="st">"#6a4b20"</span>, <span class="st">"#cea05f"</span>, <span class="st">"#e1c59d"</span>, <span class="st">"#a97833"</span>, <span class="st">"#cea05f"</span>,
               <span class="st">"#f2e6d6"</span>, <span class="st">"#6a4b20"</span>, <span class="st">"#cc9c59"</span>, <span class="st">"#dfc197"</span>, <span class="st">"#a27331"</span>, <span class="st">"#f0e3d0"</span>,
               <span class="st">"#5d421c"</span>, <span class="st">"#ca9852"</span><span class="op">)</span>;
<span class="va">land_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">farm_cols</span>, <span class="st">"#00ab41"</span>, <span class="st">"#234F1E"</span>, <span class="st">"#2832C2"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">land_eg</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, col <span class="op">=</span> <span class="va">land_cols</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.2</span>, y <span class="op">=</span> <span class="fl">0.05</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.2</span>, y <span class="op">=</span> <span class="fl">0.05</span>, labels <span class="op">=</span> <span class="st">"1"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.4</span>, y <span class="op">=</span> <span class="fl">0.1</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.4</span>, y <span class="op">=</span> <span class="fl">0.1</span>, labels <span class="op">=</span> <span class="st">"2"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.4</span>, y <span class="op">=</span> <span class="fl">0.1</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.4</span>, y <span class="op">=</span> <span class="fl">0.1</span>, labels <span class="op">=</span> <span class="st">"2"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.25</span>, y <span class="op">=</span> <span class="fl">0.27</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.25</span>, y <span class="op">=</span> <span class="fl">0.27</span>, labels <span class="op">=</span> <span class="st">"3"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.20</span>, y <span class="op">=</span> <span class="fl">0.43</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.20</span>, y <span class="op">=</span> <span class="fl">0.43</span>, labels <span class="op">=</span> <span class="st">"4"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.42</span>, y <span class="op">=</span> <span class="fl">0.48</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.42</span>, y <span class="op">=</span> <span class="fl">0.48</span>, labels <span class="op">=</span> <span class="st">"5"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.28</span>, y <span class="op">=</span> <span class="fl">0.58</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.28</span>, y <span class="op">=</span> <span class="fl">0.58</span>, labels <span class="op">=</span> <span class="st">"6"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.1</span>, y <span class="op">=</span> <span class="fl">0.8</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.1</span>, y <span class="op">=</span> <span class="fl">0.8</span>, labels <span class="op">=</span> <span class="st">"7"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.7</span>, y <span class="op">=</span> <span class="fl">0.05</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.7</span>, y <span class="op">=</span> <span class="fl">0.05</span>, labels <span class="op">=</span> <span class="st">"8"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.9</span>, y <span class="op">=</span> <span class="fl">0.2</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.9</span>, y <span class="op">=</span> <span class="fl">0.2</span>, labels <span class="op">=</span> <span class="st">"9"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.85</span>, y <span class="op">=</span> <span class="fl">0.4</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.85</span>, y <span class="op">=</span> <span class="fl">0.4</span>, labels <span class="op">=</span> <span class="st">"10"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.92</span>, y <span class="op">=</span> <span class="fl">0.58</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.92</span>, y <span class="op">=</span> <span class="fl">0.58</span>, labels <span class="op">=</span> <span class="st">"11"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.88</span>, y <span class="op">=</span> <span class="fl">0.76</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.88</span>, y <span class="op">=</span> <span class="fl">0.76</span>, labels <span class="op">=</span> <span class="st">"12"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.86</span>, y <span class="op">=</span> <span class="fl">0.93</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.86</span>, y <span class="op">=</span> <span class="fl">0.93</span>, labels <span class="op">=</span> <span class="st">"13"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.52</span>, y <span class="op">=</span> <span class="fl">0.91</span>, cex <span class="op">=</span> <span class="fl">9</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.52</span>, y <span class="op">=</span> <span class="fl">0.91</span>, labels <span class="op">=</span> <span class="st">"14"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.05</span>, y <span class="op">=</span> <span class="fl">0.59</span>, cex <span class="op">=</span> <span class="fl">7</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.05</span>, y <span class="op">=</span> <span class="fl">0.59</span>, labels <span class="op">=</span> <span class="st">"15"</span>, cex <span class="op">=</span> <span class="fl">1.7</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.46</span>, y <span class="op">=</span> <span class="fl">0.28</span>, cex <span class="op">=</span> <span class="fl">7</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.46</span>, y <span class="op">=</span> <span class="fl">0.28</span>, labels <span class="op">=</span> <span class="st">"16"</span>, cex <span class="op">=</span> <span class="fl">1.7</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.62</span>, y <span class="op">=</span> <span class="fl">0.36</span>, cex <span class="op">=</span> <span class="fl">7</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.62</span>, y <span class="op">=</span> <span class="fl">0.36</span>, labels <span class="op">=</span> <span class="st">"17"</span>, cex <span class="op">=</span> <span class="fl">1.7</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>;</code></pre></div>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-9-1.png" alt="**Figure 3**. *A complex landscape to be used in the resevol R package, including 14 separate farms, grassland, forest, and water. The image is represented in the code by a matrix in which element numbers correspond to different terrain colours (e.g., elements corresponding to water are numbered 17).*" width="672"><p class="caption">
<strong>Figure 3</strong>. <em>A complex landscape to be used in the
resevol R package, including 14 separate farms, grassland, forest, and
water. The image is represented in the code by a matrix in which element
numbers correspond to different terrain colours (e.g., elements
corresponding to water are numbered 17).</em>
</p>
</div>
<p>This <code>land_eg</code> matrix can be used in
<code>run_farm_sim</code> by setting <code>terrain = land_eg</code>. The
dimensions of the landscape will then automatically be set to
<code>xdim = 128</code> and <code>ydim = 128</code>, and the number of
farms will be set to <code>farms = 17</code>. To ensure that we do not
have pests consuming crops or pesticides from non-farm areas, we just
need to set pest consumption options accordingly. Next, we describe how
this can be done by defining how crops and pesticides will be
initialised and rotated on the landscape.</p>
</div>
<div class="section level2">
<h2 id="running-simulations">
<a name="simulation">Running simulations</a><a class="anchor" aria-label="anchor" href="#running-simulations"></a>
</h2>
<p>We will simulate the same population twice using the <code>mg</code>
pest genome and <code>land_eg</code> landscape <a href="#land">described
above</a> under two different pesticide regimes, simulation 1 and
simulation 2. In both regimes, the same pesticide is applied to farms
that occupy the same side of the river (e.g., farms 1-7 apply pesticide
1 and farms 8-14 apply pesticide 2). In simulation 1, the pesticide is
never rotated. In simulation 2, farms rotate between pesticides 1 and 2
every 9 time steps. First, we will demonstrate how to customise crop and
pesticide rotation for simulation 1, then run the simulation, and
finally show the output. Second, we will repeat the process for
simulation 2 and demonstrate how comparisons can be made between the two
simulations.</p>
<div class="section level3">
<h3 id="simulation-1">
<a name="sim1">Simulation 1</a><a class="anchor" aria-label="anchor" href="#simulation-1"></a>
</h3>
<p>First, we focus on how to set <a href="#rotation1">custom pesticide
and crop rotation</a> for simulations. Next, we run <a href="#run_farm_sim1">simulation 1</a> with the
<code>run_farm_sim</code> function. Finally, we demonstrate how to
interpret <a href="#output_sim1">output</a> for simulation 1.</p>
<div class="section level4">
<h4 id="custom-pesticide-and-crop-rotation">
<a name="rotation1">Custom pesticide and crop rotation</a><a class="anchor" aria-label="anchor" href="#custom-pesticide-and-crop-rotation"></a>
</h4>
<p>The <code>run_farm_sim</code> arguments <code>crop_init</code> and
<code>crop_rotation_type</code> specify starting crops for each farm and
how crops rotate, respectively. Equivalent arguments
<code>pesticide_init</code> and <code>pesticide_rotation_type</code>
similarly specify starting pesticides and pesticide rotations,
respectively. We can set each argument to a number as a short-hand way
of specifying these parameters. For example, the default initialisation
<code>crop_init = "random"</code> simply causes each farm to start the
simulation with a random crop. Setting values of
<code>crop_rotation_type</code> to 1, 2, or 3 causes no rotation, random
rotation, or cycling through crop numbers in sequence, respectively. But
we can generate more specific initialisation and rotation types using a
vector to initialise crops and pesticides, and using a matrix to define
rotation. For initialisation, vector elements correspond to farm number
and element values correspond to the crop initialised. For our example
with 17 unique zones of terrain on the landscape, we can define
initialised crop choice as follows.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">initial_crop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>;</code></pre></div>
<p>That is, the first 7 farms on one side of the river all start off
growing crop 1. Farms 8-14 all start off growing crop 2. Crop 3 is used
as a dummy for grassland (15), forest (16), and water (17). We explain
how to ensure that 15-17 is never used by pests below. Meanwhile, we can
specify a matrix for the crop rotation regime. This regime will cause
farmers to rotate between crops 1 and 2, but zones 15-17 to always use
‘crop’ 3.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rotate_crop</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>;
<span class="va">rotate_crop</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">rotate_crop</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">rotate_crop</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rotate_crop</span><span class="op">)</span>;</code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    0    1    0</span>
<span class="co">## [2,]    1    0    0</span>
<span class="co">## [3,]    0    0    1</span></code></pre>
<p>In the above <code>rotate_crop</code>, matrix elements define the
probability of transitioning from one crop type (rows) to another crop
type (columns). Hence, in <code>rotate_crop</code>, farms that have been
applying crop 1 will always switch to crop 2, and vice versa. Landscape
zones applying crop 3 will never transition to any other crop, nor will
any other crop transition to type 3. We can set initial pesticides and
pesticide rotation in the same way. First we set initial pesticide
use.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">initial_pesticide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>;</code></pre></div>
<p>Next, we define pesticide rotation. Recall that in simulation 1,
pesticides will not rotate and farms will maintain the same pesticide
type over all time steps.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rotate_pesticide</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>;
<span class="va">rotate_pesticide</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>     <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">rotate_pesticide</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>     <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">rotate_pesticide</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span>     <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rotate_pesticide</span><span class="op">)</span>;</code></pre></div>
<pre><code><span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    1    0    0</span>
<span class="co">## [2,]    0    1    0</span>
<span class="co">## [3,]    0    0    1</span></code></pre>
<p>We therefore have set farms to always use one of two crops and one of
two pesticides. Everything that is not a farm will use crop 3 and
pesticide 3. Next, we bring everything together and show how pests, the
landscape, and the rotation of crops and pesticides can be used in
<code>run_farm_sim</code> for simulations.</p>
</div>
<div class="section level4">
<h4 id="running-simulation-1">
<a name="run_farm_sim1">Running simulation 1</a><a class="anchor" aria-label="anchor" href="#running-simulation-1"></a>
</h4>
<p>The code below runs simulation 1 using the <code>run_farm_sim</code>
function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span>;
<span class="va">sim1</span>       <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_farm_sim.html">run_farm_sim</a></span><span class="op">(</span>mine_output             <span class="op">=</span> <span class="va">mg</span>, 
                          terrain                  <span class="op">=</span> <span class="va">land_eg</span>,
                          crop_init                <span class="op">=</span> <span class="va">initial_crop</span>,
                          crop_rotation_type       <span class="op">=</span> <span class="va">rotate_crop</span>,
                          pesticide_init           <span class="op">=</span> <span class="va">initial_pesticide</span>,
                          pesticide_rotation_type  <span class="op">=</span> <span class="va">rotate_pesticide</span>,
                          food_consume             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span>, <span class="fl">0</span><span class="op">)</span>,
                          pesticide_consume        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T3"</span>, <span class="st">"T4"</span>, <span class="fl">0</span><span class="op">)</span>,
                          crop_number              <span class="op">=</span> <span class="fl">3</span>,
                          pesticide_number         <span class="op">=</span> <span class="fl">3</span>,
                          trait_means              <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,
                          max_age                  <span class="op">=</span> <span class="fl">6</span>,
                          min_age_feed             <span class="op">=</span> <span class="fl">0</span>,
                          max_age_feed             <span class="op">=</span> <span class="fl">2</span>,
                          min_age_move             <span class="op">=</span> <span class="fl">3</span>,
                          max_age_move             <span class="op">=</span> <span class="fl">6</span>,
                          min_age_metabolism       <span class="op">=</span> <span class="fl">3</span>,
                          max_age_metabolism       <span class="op">=</span> <span class="fl">6</span>,
                          metabolism               <span class="op">=</span> <span class="fl">0.5</span>,
                          food_needed_surv         <span class="op">=</span> <span class="fl">1</span>,
                          reproduction_type        <span class="op">=</span> <span class="st">"food_based"</span>,
                          food_needed_repr         <span class="op">=</span> <span class="fl">2</span>,
                          N                        <span class="op">=</span> <span class="fl">1000</span>, 
                          repro                    <span class="op">=</span> <span class="st">"biparental"</span>,
                          mating_distance          <span class="op">=</span> <span class="fl">4</span>,
                          rand_age                 <span class="op">=</span> <span class="cn">TRUE</span>,
                          pesticide_tolerated_surv <span class="op">=</span> <span class="fl">2</span>,
                          movement_bouts           <span class="op">=</span> <span class="fl">4</span>,
                          move_distance            <span class="op">=</span> <span class="fl">2</span>,
                          crop_per_cell            <span class="op">=</span> <span class="fl">10</span>,
                          crop_sd                  <span class="op">=</span> <span class="fl">0</span>,
                          pesticide_per_cell       <span class="op">=</span> <span class="fl">1</span>,
                          pesticide_sd             <span class="op">=</span> <span class="fl">0</span>,
                          crop_rotation_time       <span class="op">=</span> <span class="fl">18</span>,
                          pesticide_rotation_time  <span class="op">=</span> <span class="fl">9</span>,
                          time_steps               <span class="op">=</span> <span class="fl">240</span>,
                          pesticide_start          <span class="op">=</span> <span class="fl">81</span>,
                          immigration_rate         <span class="op">=</span> <span class="fl">100</span>,
                          land_edge                <span class="op">=</span> <span class="st">"reflect"</span>,
                          mutation_pr              <span class="op">=</span> <span class="fl">0.01</span>,
                          crossover_pr             <span class="op">=</span> <span class="fl">0.01</span>,
                          print_gens              <span class="op">=</span> <span class="cn">TRUE</span>,
                          print_last              <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>;</code></pre></div>
<p>Immediately below the first six arguments, we have the arguments
<code>food_consume</code>, <code>pesticide_consume</code>,
<code>crop_number</code>, and <code>pesticide_number</code>. The way
that these arguments are set ensures that pests only interact with farm
cells. The rate of food consumption for the first two crops is defined
by the values of traits 1 and 2 and set as <code>"T1"</code> and
<code>"T2"</code>, respectively. The rate of consumption for crop 3 is
set to 0, meaning that no food can be eaten on these cells. Similarly,
the rate at which pesticides 1 and 2 are consumed is defined by the
values of traits 3 and 4, which are set as <code>"T3"</code> and
<code>"T4"</code>, respectively. The rate of consumption for pesticide 3
is set to 0 so that pesticide is not consumed on these cells.</p>
<p>We next set the mean values of traits at the start of the simulation
with the argument <code>trait_means</code>. Mean consumption rate of
both crops is set to 2, while mean pesticide consumption rate is set to
0 (note, negative consumption rate values are possible, but are realised
as no consumption). Pests live up to 6 time steps
(<code>max_age = 6</code>), and are defined to start feeding upon birth
(<code>min_age_feed = 0</code>) and stop at age 2
(<code>max_age_feed = 2</code>). At age 3, pests start to move
(<code>min_age_move = 3</code>) and metabolise food
(<code>min_age_metabolism = 3</code>) at a rate of
<code>metabolism = 0.5</code>. The <code>metabolism</code> argument
defines the amount of consumed food lost during the time step, which can
affect pests when food consumed affects survival
(<code>food_needed_surv</code>) and reproduction
(<code>reproduction_type</code>). By setting
<code>reproduction_type = "food_based"</code> and
<code>food_needed_surv = 1</code>, we model a system in which pests burn
the food consumed from ages 0-2 at a rate of 0.5 units per time step
after age 3, then die when their reserves drop below 1. By setting
<code>food_needed_repr = 2</code>, we ensure that only pests that have 2
or more units of food stored can reproduce. Note that if we desired, we
could also set <code>food_needed_surv</code>,
<code>food_needed_repr</code>, and <code>metabolism</code> to be
evolving traits.</p>
<p>We initialise the population with <code>N = 1000</code> obligately
biparental (<code>repro = "biparental"</code>) pests, and can find a
mate within <code>mating_distance = 4</code> cells of their own cell.
All pests are initialised at a random age
(<code>rand_age = TRUE</code>). Pests will die if they consume more than
2 total units of pesticide (<code>pesticide_tolerated_surv = 2</code>).
In each time step, pests that are able to move will do so an average of
4 times on the landscape (<code>movement_bouts = 4</code>), moving up to
2 cells in any direction during each bout
(<code>movement_distance = 2</code>). Recall that since pests consume
food and pesticide only between ages 0-2, then start moving at age 3, no
food or pesticide consumption occurs during movement (if applicable, it
could be turned on with <code>feed_while_moving = TRUE</code> and
<code>pesticide_while_moving = TRUE</code>). Each farm cell produces 10
units of crops (<code>crop_per_cell = 10</code> and
<code>crop_sd = 0</code>) and 1 unit of pesticide
(<code>pesticide_per_cell = 1</code> and <code>pesticide_sd = 0</code>).
Crops are rotated every 18 time steps
(<code>crop_rotation_time = 18</code>), and pesticides are set to rotate
every 9 time steps (<code>pesticide_rotation_time = 9</code>), but this
pesticide rotation has no effect in simulation 1 because the same
pesticide is applied upon rotation (as defined by
<code>rotate_pesticide</code>). This can be conceptualised as modelling
an 18 time step growing season in which pesticides are re-applied at the
start and halfway point of a season. Note that it is critical to
consider that crops are therefore refreshed every 18 time steps, not
every time step. Hence, any food consumed by a pest will be lost from a
cell and not replenished until crop rotation occurs. Because more than
one pest can occupy a single cell, crop loss can occur quickly depending
on how parameter values are set.</p>
<p>Lastly, we set the number of time steps to
<code>time_steps = 240</code>, and we set
<code>pesticide_start = 81</code>, which means that pesticides are not
applied at all until after a burn-in of 81 time steps. In each time
step, an average of 100 immigrants enter the population
(<code>immigration_rate = 100</code>). We set the landscape edge type to
<code>land_edge = "reflect"</code> to model a reflective edge in which
pests that attempt to leave one side of the landscape bounce back toward
the centre. Pest genome mutation rate and crossover rate at a locus are
set to <code>mutation_pr = 0.01</code> and
<code>crossover_pr = 0.01</code>, respectively. We print out the
dynamics of the evolving population over time, and all of the individual
data from the last time step, to two separate CSV files (individual data
are not included in the package due to its size). All arguments of
<code>run_farm_sim</code> not mentioned are set to default parameter
values, which can be found in the <a href="../reference/run_farm_sim.html">package documentation</a>.</p>
</div>
<div class="section level4">
<h4 id="simulation-1-output">
<a name="output_sim1">Simulation 1 output</a><a class="anchor" aria-label="anchor" href="#simulation-1-output"></a>
</h4>
<p>When running the function <code>run_farm_sim</code>, the population
size of the pest will be printed in the R console in each time step.
This is primarily because simulations can take a long time, and printing
makes it possible to estimate how much time is remaining. Printing to
the console can be turned off by setting
<code>print_gens = FALSE</code>. Once the simulation has finished, two
CSV files will be created in the working directory. The file
“population_data.csv” saves population data over time, and
“individuals.csv” saves every characteristic of all individuals in the
last time step (including full individual genomes). Here we show how to
work with the most relevant information from these two files to make
inferences about pest population and evolutionary dynamics.</p>
<p>We will start with the population level output that is printed to
“population_data.csv”, which has been renamed
“population_data_sim1.csv”.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">population_data_file_sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"population_data_sim1.csv"</span>, 
                                         package <span class="op">=</span> <span class="st">"resevol"</span><span class="op">)</span>;
<span class="va">population_data_sim1</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">population_data_file_sim1</span><span class="op">)</span>;</code></pre></div>
<p>This file includes population-level parameters of population size and
mean pest age, sex, food consumed, pesticide consumed, mortality rate,
and trait values reported for each time step. If
<code>get_f_coef = TRUE</code> in <code>run_farm_sim</code>, then mean
inbreeding coefficients of pests are also reported.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">population_data_sim1</span><span class="op">)</span><span class="op">)</span>;</code></pre></div>
<pre><code><span class="co">##   time_step population_size mean_age mean_sex mean_food_consumed</span>
<span class="co">## 1         0            1000 3.982000 2.499000           0.396658</span>
<span class="co">## 2         1             301 1.813953 2.498339           2.590001</span>
<span class="co">## 3         2             415 2.166265 2.474699           2.708252</span>
<span class="co">## 4         3             540 2.412963 2.488889           2.830218</span>
<span class="co">## 5         4             756 2.488095 2.469577           2.755487</span>
<span class="co">## 6         5             964 2.452282 2.484440           2.819527</span>
<span class="co">##   mean_pesticide_consumed mortality_rate mean_food1_consumed</span>
<span class="co">## 1                       0       0.837000            0.179506</span>
<span class="co">## 2                       0       0.205980            0.578690</span>
<span class="co">## 3                       0       0.233735            0.417990</span>
<span class="co">## 4                       0       0.218519            0.398647</span>
<span class="co">## 5                       0       0.279101            0.411980</span>
<span class="co">## 6                       0       0.312241            0.405805</span>
<span class="co">##   mean_food2_consumed mean_food3_consumed mean_pesticide1_consumed</span>
<span class="co">## 1            0.217152                   0                        0</span>
<span class="co">## 2            0.738026                   0                        0</span>
<span class="co">## 3            0.526348                   0                        0</span>
<span class="co">## 4            0.521056                   0                        0</span>
<span class="co">## 5            0.496357                   0                        0</span>
<span class="co">## 6            0.468015                   0                        0</span>
<span class="co">##   mean_pesticide2_consumed mean_pesticide3_consumed trait1_mean_value</span>
<span class="co">## 1                        0                        0          1.998091</span>
<span class="co">## 2                        0                        0          1.962117</span>
<span class="co">## 3                        0                        0          2.021925</span>
<span class="co">## 4                        0                        0          2.020423</span>
<span class="co">## 5                        0                        0          2.073448</span>
<span class="co">## 6                        0                        0          2.083852</span>
<span class="co">##   trait2_mean_value trait3_mean_value trait4_mean_value mean_f</span>
<span class="co">## 1          2.014113          0.001834          0.003205      0</span>
<span class="co">## 2          2.140079          0.041814          0.000534      0</span>
<span class="co">## 3          2.211915          0.067218          0.029188      0</span>
<span class="co">## 4          2.279216          0.034372          0.089154      0</span>
<span class="co">## 5          2.313421          0.099480          0.059904      0</span>
<span class="co">## 6          2.367128          0.105447          0.080354      0</span></code></pre>
<p>Because the structure of the data frame above depends on the number
of crops, pesticides, and evolving traits simulated, there are no
pre-set functions in the resevol package for plotting. Here we include
code for plotting population size, consumption of the two food types,
two pesticides types, and evolving trait means. Note that because crop
and pesticide 3 are dummy variables (not consumed at all), we do not
need to plot these. Figure 4 shows how population density of pests
changes over time.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mbox</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x0</span>, <span class="va">x1</span>, <span class="va">y0</span>, <span class="va">y1</span><span class="op">)</span><span class="op">{</span>
    <span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">x0</span>, to<span class="op">=</span><span class="va">x1</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>;
    <span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">y0</span>, to<span class="op">=</span><span class="va">y1</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>;
    <span class="va">xd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">x0</span>, <span class="fl">100</span><span class="op">)</span>, <span class="va">xx</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">x1</span>,<span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">)</span>;
    <span class="va">yd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">yy</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">y1</span>,<span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">yy</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">y0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>;
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xd</span>, y<span class="op">=</span><span class="va">yd</span><span class="op">)</span><span class="op">)</span>;
<span class="op">}</span>
<span class="va">season</span>          <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">240</span>, by <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>;
<span class="va">blocks</span>          <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"population_size"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>, 
     cex.axis <span class="op">=</span> <span class="fl">1.25</span>, ylab <span class="op">=</span> <span class="st">"Pest population abundance"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span>, 
     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"population_size"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">21000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"population_size"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">81</span>, lwd <span class="op">=</span> <span class="fl">3</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;</code></pre></div>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-17-1.png" alt="**Figure 4**. *Pest abundance over time in a population simulated using the resevol R package in which pesticides are not rotated over time. The grey shaded regions show individual crop seasons; pesticides are applied at the start and midpoint of each seasons, beginning at the time step indicated by the red vertical line.*" width="672"><p class="caption">
<strong>Figure 4</strong>. <em>Pest abundance over time in a population
simulated using the resevol R package in which pesticides are not
rotated over time. The grey shaded regions show individual crop seasons;
pesticides are applied at the start and midpoint of each seasons,
beginning at the time step indicated by the red vertical line.</em>
</p>
</div>
<p>Figure 5 shows how the mean consumption of different foods and
pesticides changes over time.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_food1_consumed"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>, 
     ylab <span class="op">=</span> <span class="st">"Mean crop 1 consumed"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
       y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_food1_consumed"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">0.79</span>, labels <span class="op">=</span> <span class="st">"a"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_food2_consumed"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span> ,
     ylab <span class="op">=</span> <span class="st">"Mean crop 2 consumed"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
       y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_food2_consumed"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">0.79</span>, labels <span class="op">=</span> <span class="st">"b"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_pesticide1_consumed"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>, 
     ylab <span class="op">=</span> <span class="st">"Mean pesticide 1 consumed"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
       y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_pesticide1_consumed"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">0.78</span>, labels <span class="op">=</span> <span class="st">"c"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_pesticide2_consumed"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>, 
     ylab <span class="op">=</span> <span class="st">"Mean pesticide 2 consumed"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
       y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"mean_pesticide2_consumed"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, 
       lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">0.78</span>, labels <span class="op">=</span> <span class="st">"d"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;</code></pre></div>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-18-1.png" alt="**Figure 5**. *Pest consumption over time in a population simulated using the resevol R package in which pesticides are not rotated over time. Panels show (a) mean amount of crop 1 and (b) crop 2 consumed per pest, and (c) mean amount of pesticide 1 and (d) pesticide 2 consumed per pest. Grey shaded regions show individual crop seasons; pesticides are applied at the start and midpoint of each seasons, beginning at the time step 100.*" width="672"><p class="caption">
<strong>Figure 5</strong>. <em>Pest consumption over time in a
population simulated using the resevol R package in which pesticides are
not rotated over time. Panels show (a) mean amount of crop 1 and (b)
crop 2 consumed per pest, and (c) mean amount of pesticide 1 and (d)
pesticide 2 consumed per pest. Grey shaded regions show individual crop
seasons; pesticides are applied at the start and midpoint of each
seasons, beginning at the time step 100.</em>
</p>
</div>
<p>Similarly, we can visualise how all four traits evolve over time
(Figure 6).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3.6</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait1_mean_value"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>, 
     ylab <span class="op">=</span> <span class="st">"Mean crop 1 consumption trait"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait1_mean_value"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">3.56</span>, labels <span class="op">=</span> <span class="st">"a"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3.6</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait2_mean_value"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span> ,
     ylab <span class="op">=</span> <span class="st">"Mean crop 2 consumption trait"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span>, xaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
       y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait2_mean_value"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">3.56</span>, labels <span class="op">=</span> <span class="st">"b"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.8</span>, <span class="fl">1.4</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait3_mean_value"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>, 
     ylab <span class="op">=</span> <span class="st">"Mean pesticide 1 consumption trait"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
       y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait3_mean_value"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">1.34</span>, labels <span class="op">=</span> <span class="st">"c"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.8</span>, <span class="fl">1.4</span><span class="op">)</span>,
     y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait4_mean_value"</span><span class="op">]</span><span class="op">]</span>, cex.lab <span class="op">=</span> <span class="fl">1.25</span>, 
     ylab <span class="op">=</span> <span class="st">"Mean pesticide 2 consumption trait"</span>, xlab <span class="op">=</span> <span class="st">"Time step"</span><span class="op">)</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">blocks</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rbox</span> <span class="op">&lt;-</span> <span class="fu">mbox</span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">season</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, y0 <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, y1 <span class="op">=</span> <span class="fl">6000</span><span class="op">)</span>;
    <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">rbox</span><span class="op">$</span><span class="va">y</span>, lwd <span class="op">=</span> <span class="fl">3</span>, border <span class="op">=</span> <span class="cn">NA</span>, 
                col <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span>;
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"time_step"</span><span class="op">]</span><span class="op">]</span>, 
       y <span class="op">=</span> <span class="va">population_data_sim1</span><span class="op">[[</span><span class="st">"trait4_mean_value"</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">1.34</span>, labels <span class="op">=</span> <span class="st">"d"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>;</code></pre></div>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-19-1.png" alt="**Figure 6**. *Mean values of pest traits T1 (crop 1 consumption rate), T2 (crop 2 consumption rate), T3 (pesticide 1 consumption rate), and T4 (pesticide 2 consumption rate) in a population simulated using the resevol R package in which pesticides are not rotated over time. Grey shaded regions show individual crop seasons; pesticides are applied at the start and midpoint of each seasons, beginning at the time step 100.*" width="672"><p class="caption">
<strong>Figure 6</strong>. <em>Mean values of pest traits T1 (crop 1
consumption rate), T2 (crop 2 consumption rate), T3 (pesticide 1
consumption rate), and T4 (pesticide 2 consumption rate) in a population
simulated using the resevol R package in which pesticides are not
rotated over time. Grey shaded regions show individual crop seasons;
pesticides are applied at the start and midpoint of each seasons,
beginning at the time step 100.</em>
</p>
</div>
<p>Next, we look at the file that includes the complete information for
all individuals in the last time step of the simulation. Using this data
set, we can examine the distribution of pests on the landscape, and the
realised covariance of evolving pest traits. In this output
“last_time_step.csv”, traits always begin in column 102, meaning that
individual trait values for traits 1, 2, 3, and 4 will be in columns
102, 103, 104, and 105, respectively. In this example, the CSV output
file “last_time_step.csv” has been renamed “last_time_step_sim1.csv”. To
minimise the size of the resevol R package, all data columns except pest
locations and traits have been removed from example outputs, so pest
locations are in columns 1-2 (not 3-4) and traits are in columns 3-6
(not 102-105). The last time step output is read into R below.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">last_time_step_file_sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"last_time_step_sim1.csv"</span>, 
                                        package <span class="op">=</span> <span class="st">"resevol"</span><span class="op">)</span>;
<span class="va">pop_last_time_step_sim1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">last_time_step_file_sim1</span><span class="op">)</span>;</code></pre></div>
<p>We can plot the distribution over the landscape using the code below.
The code identifies the x-locations and y-locations of each pest
<code>i</code> in <code>pop_last_time_step_sim1</code>, and these
landscape cells are replaced with the number 18. A new land colour for
black <code>#000000</code> is then included, and the map is reproduced
as an image in R. Figure 7 shows the same map as above, but with the
numbering removed to make the pests (black points) more visible.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>;
<span class="va">landscape</span>    <span class="op">&lt;-</span> <span class="va">land_eg</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pop_last_time_step_sim1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>
    <span class="va">xloc</span> <span class="op">&lt;-</span> <span class="va">pop_last_time_step_sim1</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>;
    <span class="va">yloc</span> <span class="op">&lt;-</span> <span class="va">pop_last_time_step_sim1</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>;
    <span class="va">landscape</span><span class="op">[</span><span class="va">xloc</span>, <span class="va">yloc</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">18</span>;
<span class="op">}</span>
<span class="va">land_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">land_cols</span>, <span class="st">"#000000"</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">landscape</span>, xaxt <span class="op">=</span> <span class="st">"n"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span>, col <span class="op">=</span> <span class="va">land_cols</span><span class="op">)</span>;</code></pre></div>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-21-1.png" alt="**Figure 7**. *A complex landscape for simulating the ecology of pests and the evolution of pesticide resistance on farmland in the resevol R package. Terrain includes farms (brown colours), grassland (light green), forest (dark green), and water (blue). Black points show the locations of individual pests after 240 time steps for a simulation in which pesticides are not rotated over time.*" width="672"><p class="caption">
<strong>Figure 7</strong>. <em>A complex landscape for simulating the
ecology of pests and the evolution of pesticide resistance on farmland
in the resevol R package. Terrain includes farms (brown colours),
grassland (light green), forest (dark green), and water (blue). Black
points show the locations of individual pests after 240 time steps for a
simulation in which pesticides are not rotated over time.</em>
</p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pop_last_time_step_sim1</span><span class="op">)</span>;</code></pre></div>
<pre><code><span class="co">##    V3  V4     V102     V103      V104      V105</span>
<span class="co">## 1  33  13 2.395557 3.485652 -1.413820  2.185108</span>
<span class="co">## 2  94 109 4.325184 1.408115  1.212488 -0.505254</span>
<span class="co">## 3 108  58 4.583821 3.336972  2.907757 -1.297925</span>
<span class="co">## 4 108  61 3.385105 2.619580  1.399597 -0.577378</span>
<span class="co">## 5   2  47 3.713334 3.623724 -0.853502  2.222031</span>
<span class="co">## 6  87  63 4.034968 3.601765  1.555337 -0.060638</span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">land_cols</span><span class="op">)</span>;</code></pre></div>
<pre><code><span class="co">##  [1] "#f4eadc" "#6a4b20" "#cea05f" "#e1c59d" "#a97833" "#cea05f" "#f2e6d6"</span>
<span class="co">##  [8] "#6a4b20" "#cc9c59" "#dfc197" "#a27331" "#f0e3d0" "#5d421c" "#ca9852"</span>
<span class="co">## [15] "#00ab41" "#234F1E" "#2832C2" "#000000"</span></code></pre>
<p>The spatial pattern of pests over the landscape can be useful for
visualising pest population dynamics. In the case of the above, pest
density is higher on some farms (e.g., 1, 8, 9, 10, and 15) than others
(e.g., 3, 12, and 13), and this pest density could be interpreted with
respect to individual farm crop and pesticide rotation regimes. Hence,
for the four evolving traits, a covariance matrix of pest traits can be
calculated at the end of the simulation.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">end_trait_covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">pop_last_time_step_sim1</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end_trait_covs</span><span class="op">)</span>;</code></pre></div>
<pre><code><span class="co">##            V102       V103       V104       V105</span>
<span class="co">## V102  1.1223660 -0.1485266  0.2470207  0.1506317</span>
<span class="co">## V103 -0.1485266  1.3351424 -0.0714354  0.5612672</span>
<span class="co">## V104  0.2470207 -0.0714354  2.9213039 -2.8459986</span>
<span class="co">## V105  0.1506317  0.5612672 -2.8459986  3.1352726</span></code></pre>
<p>The above covariance matrix shows that after 240 time steps, the
covariance between consumption of pesticides 1 and 2 has decreased from
-0.3992066 to -2.8459986, suggesting that the trade-off for resisting
pesticides had become stronger. In contrast, the covariance between
consumption of crops 1 and 2 has increased from -0.4510309 to
-0.1485266, suggesting that the trade-off in ability to consume crops of
each type has weakened.</p>
</div>
</div>
<div class="section level3">
<h3 id="simulation-2">
<a name="sim2">Simulation 2</a><a class="anchor" aria-label="anchor" href="#simulation-2"></a>
</h3>
<p>We now repeat the simulations such that pesticide application is
rotated every 9 time steps. To make this rotation, we only need to
redefine <code>rotate_pesticide</code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rotate_pesticide</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>;
<span class="va">rotate_pesticide</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>     <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">rotate_pesticide</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>     <span class="op">&lt;-</span> <span class="fl">1</span>;
<span class="va">rotate_pesticide</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span>     <span class="op">&lt;-</span> <span class="fl">1</span>;</code></pre></div>
<p>Now, every 9 time steps, crops using pesticide 1 will switch to
pesticide 2, and crops using pesticide 2 will switch to pesticide 1. We
can re-run the same simulation with the same genome (<code>mg</code>),
landscape (<code>land_eg</code>), and simulation seed
(<code>2022</code>) used in simulation 1. Hence, the only thing changing
between the two simulations is the pesticide rotation.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span>;
<span class="va">sim2</span>       <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_farm_sim.html">run_farm_sim</a></span><span class="op">(</span>mine_output             <span class="op">=</span> <span class="va">mg</span>, 
                          terrain                  <span class="op">=</span> <span class="va">land_eg</span>,
                          crop_init                <span class="op">=</span> <span class="va">initial_crop</span>,
                          crop_rotation_type       <span class="op">=</span> <span class="va">rotate_crop</span>,
                          pesticide_init           <span class="op">=</span> <span class="va">initial_pesticide</span>,
                          pesticide_rotation_type  <span class="op">=</span> <span class="va">rotate_pesticide</span>,
                          food_consume             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span>, <span class="fl">0</span><span class="op">)</span>,
                          pesticide_consume        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T3"</span>, <span class="st">"T4"</span>, <span class="fl">0</span><span class="op">)</span>,
                          crop_number              <span class="op">=</span> <span class="fl">3</span>,
                          pesticide_number         <span class="op">=</span> <span class="fl">3</span>,
                          trait_means              <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,
                          max_age                  <span class="op">=</span> <span class="fl">6</span>,
                          min_age_feed             <span class="op">=</span> <span class="fl">0</span>,
                          max_age_feed             <span class="op">=</span> <span class="fl">2</span>,
                          min_age_move             <span class="op">=</span> <span class="fl">3</span>,
                          max_age_move             <span class="op">=</span> <span class="fl">6</span>,
                          min_age_metabolism       <span class="op">=</span> <span class="fl">3</span>,
                          max_age_metabolism       <span class="op">=</span> <span class="fl">6</span>,
                          metabolism               <span class="op">=</span> <span class="fl">0.5</span>,
                          food_needed_surv         <span class="op">=</span> <span class="fl">1</span>,
                          reproduction_type        <span class="op">=</span> <span class="st">"food_based"</span>,
                          food_needed_repr         <span class="op">=</span> <span class="fl">2</span>,
                          N                        <span class="op">=</span> <span class="fl">1000</span>, 
                          repro                    <span class="op">=</span> <span class="st">"biparental"</span>,
                          mating_distance          <span class="op">=</span> <span class="fl">4</span>,
                          rand_age                 <span class="op">=</span> <span class="cn">TRUE</span>,
                          pesticide_tolerated_surv <span class="op">=</span> <span class="fl">2</span>,
                          movement_bouts           <span class="op">=</span> <span class="fl">4</span>,
                          move_distance            <span class="op">=</span> <span class="fl">2</span>,
                          crop_per_cell            <span class="op">=</span> <span class="fl">10</span>,
                          crop_sd                  <span class="op">=</span> <span class="fl">0</span>,
                          pesticide_per_cell       <span class="op">=</span> <span class="fl">1</span>,
                          pesticide_sd             <span class="op">=</span> <span class="fl">0</span>,
                          crop_rotation_time       <span class="op">=</span> <span class="fl">18</span>,
                          pesticide_rotation_time  <span class="op">=</span> <span class="fl">9</span>,
                          time_steps               <span class="op">=</span> <span class="fl">240</span>,
                          pesticide_start          <span class="op">=</span> <span class="fl">81</span>,
                          immigration_rate         <span class="op">=</span> <span class="fl">100</span>,
                          land_edge                <span class="op">=</span> <span class="st">"reflect"</span>,
                          mutation_pr              <span class="op">=</span> <span class="fl">0.01</span>,
                          crossover_pr             <span class="op">=</span> <span class="fl">0.01</span>,
                          print_gens              <span class="op">=</span> <span class="cn">TRUE</span>,
                          print_last              <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>;</code></pre></div>
<p>We can look at the same outputs for simulation 2 that we did for
simulation 1. We first read in the output for simulation 2.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">population_data_file_sim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"population_data_sim2.csv"</span>, 
                                    package <span class="op">=</span> <span class="st">"resevol"</span><span class="op">)</span>;
<span class="va">population_data_sim2</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">population_data_file_sim2</span><span class="op">)</span>;</code></pre></div>
<p>To avoid needless repetition, the code for plots will not be included
for simulation 2. Figure 8 shows population abundance over time for
simulation 2.</p>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-26-1.png" alt="**Figure 8**. *Pest abundance over time in a population simulated using the resevol R package in which pesticides rotates every 9 time steps. The grey shaded regions show individual crop seasons; pesticides are applied at the start and midpoint of each seasons, beginning at the time step indicated by the red vertical line.*" width="672"><p class="caption">
<strong>Figure 8</strong>. <em>Pest abundance over time in a population
simulated using the resevol R package in which pesticides rotates every
9 time steps. The grey shaded regions show individual crop seasons;
pesticides are applied at the start and midpoint of each seasons,
beginning at the time step indicated by the red vertical line.</em>
</p>
</div>
<p>After pesticides are applied at time step 81, pest population size
decreases and does not recover. Figure 9 shows crop and pesticide
consumption over time.</p>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-27-1.png" alt="**Figure 9**. *Pest consumption over time in a population simulated using the resevol R package in which pesticides rotate every 9 time steps. Panels show (a) mean amount of crop 1 and (b) crop 2 consumed per pest, and (c) mean amount of pesticide 1 and (d) pesticide 2 consumed per pest. Grey shaded regions show individual crop seasons; pesticides are applied at the start and midpoint of each seasons, beginning at the time step 100.*" width="672"><p class="caption">
<strong>Figure 9</strong>. <em>Pest consumption over time in a
population simulated using the resevol R package in which pesticides
rotate every 9 time steps. Panels show (a) mean amount of crop 1 and (b)
crop 2 consumed per pest, and (c) mean amount of pesticide 1 and (d)
pesticide 2 consumed per pest. Grey shaded regions show individual crop
seasons; pesticides are applied at the start and midpoint of each
seasons, beginning at the time step 100.</em>
</p>
</div>
<p>Figure 10 shows how pest traits evolve over time when pesticides are
rotated.</p>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-28-1.png" alt="**Figure 10**. *Mean values of pest traits T1 (crop 1 consumption rate), T2 (crop 2 consumption rate), T3 (pesticide 1 consumption rate), and T4 (pesticide 2 consumption rate) in a population simulated using the resevol R package in which pesticides rotate every 9 time steps. Grey shaded regions show individual crop seasons; pesticides are applied at the start and midpoint of each seasons, beginning at the time step 100.*" width="672"><p class="caption">
<strong>Figure 10</strong>. <em>Mean values of pest traits T1 (crop 1
consumption rate), T2 (crop 2 consumption rate), T3 (pesticide 1
consumption rate), and T4 (pesticide 2 consumption rate) in a population
simulated using the resevol R package in which pesticides rotate every 9
time steps. Grey shaded regions show individual crop seasons; pesticides
are applied at the start and midpoint of each seasons, beginning at the
time step 100.</em>
</p>
</div>
<p>We can observe the spatial distribution of pests on the landscape in
the final time step (Figure 11).</p>
<div class="figure" style="text-align: left">
<img src="advanced_techniques_files/figure-html/unnamed-chunk-29-1.png" alt="**Figure 11**. *A complex landscape for simulating the ecology of pests and the evolution of pesticide resistance on farmland in the resevol R package. Terrain includes farms (brown colours), grassland (light green), forest (dark green), and water (blue). Black points show the locations of individual pests after 240 time steps for a simulation in which pesticides are not rotated over time.*" width="672"><p class="caption">
<strong>Figure 11</strong>. <em>A complex landscape for simulating the
ecology of pests and the evolution of pesticide resistance on farmland
in the resevol R package. Terrain includes farms (brown colours),
grassland (light green), forest (dark green), and water (blue). Black
points show the locations of individual pests after 240 time steps for a
simulation in which pesticides are not rotated over time.</em>
</p>
</div>
<p>Finally, we can examine the trait covariances in the final time step
below.</p>
<pre><code><span class="co">##            V102        V103       V104        V105</span>
<span class="co">## V102  1.5769217 -0.53211838  0.0665547  0.35835679</span>
<span class="co">## V103 -0.5321184  1.29401550  0.2987174  0.01794992</span>
<span class="co">## V104  0.0665547  0.29871744  0.9629416 -0.81135108</span>
<span class="co">## V105  0.3583568  0.01794992 -0.8113511  0.96416686</span></code></pre>
<p>We can use the outputs above to contrast the population dynamics of
pests under a regime that lacks (simulation 1) or does not lack
(simulation 2) the rotation of pesticide types.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">
<a name="conclusion">Conclusion</a><a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>From the output above, we can conclude that when farms rotate the
pesticide that they apply between pesticide 1 and pesticide 2, it has a
substantial effect on pest density and evolution. In the absence of
pesticide rotation, the pest population quickly recovers after
pesticides are first applied (Figure 4). Consequently, pesticides have
very little long-term effect on the amount of crops consumed (Figure
5a,b), and while there is an initial spike in the consumption of both
pesticides (Figure 5c,d), this consumption quickly declines. Despite the
positive covariance between crop consumption and pesticide consumption,
and the negative covariances between consumption of crop and pesticide
types, these trade-offs appear to have only a modest effect on reducing
actual crop consumption and maintaining or increasing pesticide
consumption (Figure 6). Consequently, some farms experience high
densities of pests that are resistant to the applied pesticides (Figure
7).</p>
<p>In contrast, when pesticides are rotated every 9 time steps, the pest
population density drops after the onset of pesticide application and
does not recover (Figure 8). The amount of each crop consumed per pests
also drops (Figure 9a, b), while the amount of pesticide 1 and 2
consumed is maintained at a much higher rate than occurred in the
absence of pesticide rotation (Figure 9c, d). Because selection against
pesticide consumption was not consistent for a specific farm, and there
is a trade-off between pest consumption of pesticide 1 versus 2, local
adaptation to a single pesticide did not occur (Figure 10). Overall,
farms therefore did not experience high densities of pests, and pest
resistance to pesticide is well-managed (Figure 11).</p>
<p>Trait covariance differences between simulations 1 and 2 also
highlight the effect that pesticide rotation had on pesticide resistance
evolution. When no pesticide rotation occurred, the trade-off between
consumption rate of pesticides 1 and 2 was reflected in a realised trait
covariance of -2.8459986. But when pesticides were rotated, the realised
covariance was instead -0.8113511. This means that in simulation 1,
pests that are highly resistant to pesticide 1 were not highly resistant
to pesticide 2, and vice versa. In other words, the lack of pesticide
rotation resulted in local adaptation, with some pests specialising on
resistance to one of the two pesticides. In simulation 2, pests
maintained at least some resistance to both pesticides. Local adaptation
was not possible because different pesticides were applied in sequence
on any given farm.</p>
<p>This advanced example was not rigorous, but it illustrates how a
rigorous simulation of pesticide resistance evolution could be designed
with the resevol R package. To make robust predictions, multiple
replicate simulations would need to be run for the same set of
simulation conditions (in this case, for simulation 1 and 2) to account
for stochastic effects in the model. For example, we might repeat the
above <a href="#mining">initalisation</a> of pest genomes to obtain 20
genomes with similar covariance structures, then run <a href="#sim1">simulation 1</a> and <a href="#sim2">simulation 2</a> 20
times to get more robust predictions about pest population dynamics. We
might also need to consider a range of parameter values if some values
are unknown or uncertain (e.g., pest movement or trait means). To
develop theory, we could also contrast simulations with more fundamental
differences. For example, we might test how mating system affects
pesticide resistance evolution by running the same set of simulations
for <code>repro = "asexual"</code>, <code>repro = "sexual"</code>, and
<code>repro = "biparental"</code>. The resevol R package is therefore a
highly flexible and powerful tool for running complex models tailored to
specific systems, and for developing theory on pest ecology, evolution,
and management.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="literature-cited">
<a name="lit">Literature Cited</a><a class="anchor" aria-label="anchor" href="#literature-cited"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Hamblin2013" class="csl-entry">
Hamblin, Steven. 2013. <span>“<span class="nocase">On the practical
usage of genetic algorithms in ecology and evolution</span>.”</span>
<em>Methods in Ecology and Evolution</em> 4 (2): 184–94. <a href="https://doi.org/10.1111/2041-210X.12000" class="external-link">https://doi.org/10.1111/2041-210X.12000</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by A. Bradley Duthie, Rose McKeon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
